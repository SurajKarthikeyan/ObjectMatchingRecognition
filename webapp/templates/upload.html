<!-- Initally displayed file -->
<!-- Gives two variables: part, whole -->
<!-- calls /upload when "Upload" is pressed -->

<!DOCTYPE html>
<html>
<head>
    <title>File Upload</title>
    <link href="../static/cropperjs/cropper.css" rel="stylesheet">
    <script type="module" src="../static/cropperjs/cropper.js"></script>
</head>
<body>
    <form method="POST" action="/upload" enctype="multipart/form-data">
        <!-- Partial Image, Whole Image, Upload button-->
        <input type="file" name="part" onchange = "enableScreenshotButton()">
        <input type="file" name="whole">
        <input type="submit" value="Generate">
    </form>

    <link href="../static/cropperjs/cropper.css" rel="stylesheet">
<div class="container">
    <div>
        <img id="testimage" class="croppingimage" src="../static/uploads/eyespy5.png">
        <button onclick="crop()" style="margin: 15px;">Crop</button>
    </div>

    <div>
        <img id="output" class="croppingoutput" src="">
    </div>
</div>

</body>

<style>
    #container {
    margin: 30px auto;
    width: 500px;
    height: 375px;
    border: 10px #333 solid;
    }
    #videoElement {
    width: 500px;
    height: 375px;
    background-color: #666;
    }

    .croppingimage {
        display: block;
        width: 100px;
        height: 100px;
        max-width: 100%;
    }

    .croppingoutput{
        margin: 5px;
    }
</style>

<body>
<div id="container">
	<video autoplay="true" id="videoElement">
	</video>
    <br>
	<button id = screenshotButton onclick="captureScreenshot()" style="margin: 15px;">Capture Screenshot</button>
    <br>
</div>
<script>
    document.getElementById('screenshotButton').disabled = true;
    var video = document.querySelector("#videoElement");
    const screenshotImage = document.createElement('img');
    if (navigator.mediaDevices.getUserMedia) {
      navigator.mediaDevices.getUserMedia({ video: true })
        .then(function (stream) {
          video.srcObject = stream;
        })
        .catch(function (error) {
          console.log("Something went wrong!");
        });
    }

        function captureScreenshot() {
        // Create a canvas element to draw the screenshot
        const canvas = document.createElement('canvas');
        const context = canvas.getContext('2d');
        canvas.width = videoElement.videoWidth;
        canvas.height = videoElement.videoHeight;

        // Draw the current frame from the video onto the canvas
        context.drawImage(videoElement, 0, 0, canvas.width, canvas.height);

        // Convert the canvas content to a data URL with JPEG format and quality
        const dataURL = canvas.toDataURL('image/jpeg', 1);

        // Create an image element for the screenshot

        screenshotImage.src = dataURL;
        screenshotImage.width = 320; // Set a specific width for display (optional)

        // Append the image element to the document or do something else with the screenshot
        }
    document.body.appendChild(screenshotImage);
    var cropman;
    document.addEventListener('DOMContentLoaded', function () {
        // Wrap your code in this event listener

        const image = document.querySelector('.croppingimage');
        cropman = new Cropper(image, {
            aspectRatio: 0,
            viewMode: 0,
        });
    });
    function crop() {
        var croppedImage = cropman.getCroppedCanvas().toDataURL("image/png");
        document.getElementById('output').src = croppedImage;
    }

    function enableScreenshotButton(){
        document.getElementById('screenshotButton').disabled = false;
    }
</script>
</body>
</html>